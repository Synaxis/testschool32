(function(a){a(function(){a("#recent-news .show-more-news").click(function(b){b.preventDefault();a("#recent-news .front-forum-post.hidden").hide().removeClass("hidden").slideDown(1000);a("#recent-news .show-more-news").fadeOut()});a(".trigger-language").click(function(){a(".header-language").slideToggle("fast")})})})(jQuery);(function(d){var a=location.href.replace(/#.*/,"");var c=d.localScroll=function(e){d("body").localScroll(e)};c.defaults={duration:1000,axis:"y",event:"click",stop:true,target:window,reset:true};c.hash=function(f){if(location.hash){f=d.extend({},c.defaults,f);f.hash=false;if(f.reset){var g=f.duration;delete f.duration;d(f.target).scrollTo(0,f);f.duration=g}b(0,location,f)}};d.fn.localScroll=function(e){e=d.extend({},c.defaults,e);return e.lazy?this.bind(e.event,function(g){var h=d([g.target,g.target.parentNode]).filter(f)[0];if(h){b(g,h,e)}}):this.find("a,area").filter(f).bind(e.event,function(g){b(g,this,e)}).end().end();function f(){return !!this.href&&!!this.hash&&this.href.replace(this.hash,"")==a&&(!e.filter||d(this).is(e.filter))}};function b(i,p,g){var q=p.hash.slice(1),o=document.getElementById(q)||document.getElementsByName(q)[0];if(!o){return}if(i){i.preventDefault()}var n=d(g.target);if(g.lock&&n.is(":animated")||g.onBefore&&g.onBefore.call(g,i,o,n)===false){return}if(g.stop){n.stop(true)}if(g.hash){var m=o.id==q?"id":"name",l=d("<a> </a>").attr(m,q).css({position:"absolute",top:d(window).scrollTop(),left:d(window).scrollLeft()});o[m]="";d("body").prepend(l);location=p.hash;l.remove();o[m]=q}n.scrollTo(o,g).trigger("notify.serialScroll",[o])}})(jQuery);(function(d){var c=d.serialScroll=function(a){return d(window).serialScroll(a)};c.defaults={duration:1000,axis:"x",event:"click",start:0,step:1,lock:!0,cycle:!0,constant:!0};d.fn.serialScroll=function(a){return this.each(function(){var v=d.extend({},c.defaults,a),w=v.event,G=v.step,x=v.lazy,K=v.target?this:document,b=d(v.target||this,K),z=b[0],C=v.items,H=v.start,I=v.interval,E=v.navigation,D;if(!x){C=L()}if(v.force){J({},H)}d(v.prev||[],K).bind(w,-G,y);d(v.next||[],K).bind(w,G,y);if(!z.ssbound){b.bind("prev.serialScroll",-G,y).bind("next.serialScroll",G,y).bind("goto.serialScroll",J)}if(I){b.bind("start.serialScroll",function(e){if(!I){A();I=!0;B()}}).bind("stop.serialScroll",function(){A();I=!1})}b.bind("notify.serialScroll",function(e,f){var g=F(f);if(g>-1){H=g}});z.ssbound=!0;if(v.jump){(x?b:L()).bind(w,function(e){J(e,F(e.target))})}if(E){E=d(E,K).bind(w,function(e){e.data=Math.round(L().length/E.length)*E.index(this);J(e,this)})}function y(e){e.data+=H;J(e,this)}function J(g,i){if(!isNaN(i)){g.data=i;i=z}var f=g.data,m,e=g.type,h=v.exclude?L().slice(0,-v.exclude):L(),j=h.length,l=h[f],k=v.duration;if(e){g.preventDefault()}if(I){A();D=setTimeout(B,v.interval)}if(!l){m=f<0?0:j-1;if(H!=m){f=m}else{if(!v.cycle){return}else{f=j-m-1}}l=h[f]}if(!l||v.lock&&b.is(":animated")||e&&v.onBefore&&v.onBefore(g,l,b,L(),f)===!1){return}if(v.stop){b.queue("fx",[]).stop()}if(v.constant){k=Math.abs(k/G*(H-f))}b.scrollTo(l,k,v).trigger("notify.serialScroll",[f])}function B(){b.trigger("next.serialScroll")}function A(){clearTimeout(D)}function L(){return d(C,z)}function F(f){if(!isNaN(f)){return f}var e=L(),g;while((g=e.index(f))==-1&&f!=z){f=f.parentNode}return g}})}})(jQuery);$(document).ready(function(){var c=true;var d=8000;var i=$("h1_scroll_container");var f=parseInt(i.css("paddingLeft")||0)*-1;var e=$("#highlights .hl_scroll");var h=$("#hl_navigation li");var a={target:e,items:"div.panel",navigation:"#hl_navigation li",offset:f,duration:500,axis:"xy",easing:"swing",step:1,hash:true,onAfter:b};function b(j){h.removeClass("selected");el='a[href$="'+j.id+'"]';$(el).parent().addClass("selected")}function g(){e.trigger("next");auto_rotate=setTimeout(g,d)}e.serialScroll(a);e.mouseenter(function(){clearTimeout(auto_rotate)});e.mouseleave(function(){if(c){auto_rotate=setTimeout(g,d)}});$.localScroll(a);if(window.location.hash){b({id:window.location.hash.substr(1)})}$("#highlights").click(function(){$(this).parents("ul:first").find("li").removeClass("selected").end().end().addClass("selected");clearTimeout(auto_rotate);c=false});auto_rotate=setTimeout(g,d)});(function(b){var c=b._,d=b.jQuery,a=b.BFH=b.BFH||{};d(function(){var e=d("#nps"),g,h,f;d("#nps li").one("click",function(){g=d(this),h=g.find("input").val(),f=e.find("#csrf_token").val();e.find(".submit").fadeOut("200");e.addClass("loading");d.post(a.API.submitScore,{score:h,_csrf_token:f},"json");setTimeout(function(){e.find(".thanks").fadeIn("200");e.removeClass("loading");e.find(".thanks").fadeIn("200");e.removeClass("loading")},500)})})}(this));(function(g){var k=g._,d=g.jQuery,a=g.Modernizr,i=g.document,c=g.console||{log:function(n){d("body").append('<span style="display: none;">'+n+"</span>")}},j=g.Backbone,l=g.BFH=g.BFH||{},e=l.WarRoom=l.WarRoom||{},f=j.Model.extend({initialize:function(){},isNational:function(){return this.get("defenderTeam")===1},isRoyal:function(){return this.get("defenderTeam")===2},isCapital:function(){return this.get("isCapital")}}),b=j.Collection.extend({model:f,initialize:function(){},getNumberOfTerritories:function(){return this.length},getNumberOfRoyalTerritories:function(){return this.filter(function(n){return n.isRoyal()}).length},getNumberOfNationalTerritories:function(){return this.filter(function(n){return n.isNational()}).length}}),h=j.View.extend({className:"territory",initialize:function(){var n=this;n.classes="";n.classes+=" t"+n.model.id;if(n.model.isNational()){n.classes+=" national"}else{if(n.model.isRoyal()){n.classes+=" royal"}}if(n.model.isCapital()){n.classes+=" capital"}if(n.model.get("defenderLevel")){n.classes+=" defense size-"+n.model.get("defenderLevel")}this.el.className+=n.classes},render:function(){var n=this;n.$el.append(n.model.get("name"));return n.el}}),m=j.View.extend({initialize:function(){var n=this;this._territoryViews=[];n.collection.each(function(o){n._territoryViews.push(new h({id:o.get("id"),model:o,parent:n}))})},render:function(){var n=this;k(this._territoryViews).each(function(o){n.$el.find(".map").append(o.render())})}});l.initWarRoomStatus=function(){d.getJSON(l.API.getTerritories,function(n){e.territoryData=n.data;e.territoriesCollection=new b(k.values(e.territoryData));e.statusView=new m({collection:e.territoriesCollection,el:d("#warRoomStatus")});e.statusView.render();d("#warRoomStatus.display").find(".royals.stats .hex").html(e.territoriesCollection.getNumberOfRoyalTerritories());d("#warRoomStatus.display").find(".nationals.stats .hex").html(e.territoriesCollection.getNumberOfNationalTerritories())})};l.initWarRoomDisplay=function(){}}(this));jQuery(function(a){a(".newsList .mainVideo").each(function(){a(this).html('<iframe class="youtube-player" type="text/html" width="482" height="271" src="http://www.youtube.com/embed/'+a(this).data("videoid")+'?wmode=transparent&autohide=1&showinfo=0" frameborder="0"></iframe>')});a(".newsPostArchive").find(".newsItem.defaultState").click(function(){a(this).removeClass("defaultState").find(".postContent:hidden").slideDown()})});